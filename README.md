# Futaba ID Counter (WebExtensions)

ID表示のスレにIDカウンタ※を追加したりするFirefox拡張機能(WebExtensions)。

※IDカウンタ＝IDのその地点までの出現数(レス内の全出現数ではない)

赤福の「続きを読む」にも対応 (稀にバグる可能性あり?)

![screenshot](screenshot.jpg)

## 機能

+ IDカウンタ付加:
  ID:xxxx の横に同IDのそれまでの出現回数を[2]のように表示する
  * 単発IDには表示しない(変更可能)
  * スレあきのIDには印を付けて特別視する
  * カウンタ部のクリックでそのIDの次のレスへスクロールする(+SHIFTで前のレスへ)

+ ID集計:
  スレ末尾にスレ内IDのユニーク数(単発ID数)を表示する

+ IDポップアップ:
  ID表現(のある行)／IDカウンタをポイント → 同IDのレスをポップアップ表示
  * 1レス目・レス中のID表現からは他の全レスを、2レス目以降では(内容のある)1レス目を
  * 1レス目表示 → (他の)全レス表示への切り替え
  * ポップアップ中のIDカウンタ部クリックでそのレスの場所へスクロール

## 既知の問題

* 赤福の「続きを読む」の場合でもいちいち全体を走査し直す仕様なので
  長いスレだとその処理が大変かもしれない。効率とか考えてない。

* IDカウンタ付きで保存しても動的要素は働かない。保存するときは全消ししておこう。

* IDポップアップ
  * 赤福のそれに似せてるけど別物なので、いろいろと挙動が違う。合わせるのめどい。
  * 画面右端付近で開かれるとサイズがきつくなる。水平方向は調整していないから。
  * 引用したレスのNo.に赤福が反応してポップアップする。意図していないが問題じゃないから放置。
  * 赤福のポップアップにマウスを動かすとこちらのポップアップは消える。別にいいよね？
  * 赤福ポップアップ内のIDカウンタからはIDポップアップしない(IDテキスト自体からはポップアップできるからまあいいか)
  * IDポップアップ中の引用から赤福ポップアップすると順序的に変なレスに反応する（IDポップアップ内も引用の検索範囲になっている）
  * ID:xxxx の真上だけでなく同じ行にIDがあればポップアップしてしまう(赤福のNo.ポップアップと似たような挙動)
  * IDが一行に複数でてくる場合(稀だろうが)に、最初のIDしか関知しない。

## カスタマイズ

挙動はアドオンマネージャから呼び出せるIDカウンターの設定UIで変更できる。
保存した設定は拡張機能を削除するまで保存されている。
設定を変更しても既に開いているスレでのIDカウンターの挙動は変わらないので、
反映させるためにはリロードする必要がある。

ページ末尾の設定ボタンからはスレ毎の挙動を変更できる(保存されない)。

